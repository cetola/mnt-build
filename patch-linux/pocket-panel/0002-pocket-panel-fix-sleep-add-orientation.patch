From 7db1d1e320e1e0a96bef4d427c72177e0ea28073 today
From: Lukas F. Hartmann <lukas@mntre.com>
Date:   Thu May 22 17:18:42 2025 +0200
Subject:  pocket/panel: sleep fix v3

diff --git a/drivers/gpu/drm/panel/panel-mnt-pocket-reform.c b/drivers/gpu/drm/panel/panel-mnt-pocket-reform.c
index 7335bd6..7f6a19b 100644
--- a/drivers/gpu/drm/panel/panel-mnt-pocket-reform.c
+++ b/drivers/gpu/drm/panel/panel-mnt-pocket-reform.c
@@ -6,7 +6,7 @@
  * Copyright (C) 2016 Linaro Ltd
  * Author: Sumit Semwal <sumit.semwal@linaro.org>
  *
- * Copyright (C) 2024 MNT Research GmbH
+ * Copyright (C) 2025 MNT Research GmbH
  * Author: Lukas Hartmann <lukas@mntre.com>
  */
 
@@ -24,6 +24,7 @@
 #include <drm/drm_mipi_dsi.h>
 #include <drm/drm_modes.h>
 #include <drm/drm_panel.h>
+#include <drm/drm_connector.h>
 
 static const char * const regulator_names[] = {
 	"vddp",
@@ -522,11 +523,7 @@ static int jdi_panel_disable(struct drm_panel *panel)
 
 	jdi->enabled = false;
 	mipi_dsi_dcs_set_display_off(jdi->dsi);
-	if (jdi->panel_version == 2) return 0;
-	
-	mipi_dsi_dcs_enter_sleep_mode(jdi->dsi);
-	msleep(100);
-	backlight_disable(jdi->backlight);
+	if (jdi->backlight) backlight_disable(jdi->backlight);
 
 	return 0;
 }
@@ -617,6 +614,10 @@ static int jdi_panel_enable(struct drm_panel *panel)
 	} else {
 		jdi->dsi->mode_flags |= MIPI_DSI_MODE_LPM;
 		ret = mipi_dsi_dcs_set_display_on(jdi->dsi);
+		if (ret < 0) {
+			dev_err(dev, "[display] failed to turn display on in enable: %d\n", ret);
+		}
+		if (jdi->backlight) backlight_enable(jdi->backlight);
 	}
 	jdi->enabled = true;
 
@@ -696,12 +697,18 @@ static int jdi_panel_get_modes(struct drm_panel *panel,
 	return 1;
 }
 
+static enum drm_panel_orientation jdi_panel_get_orientation(struct drm_panel* panel) {
+	// pocket reform panel is rotated -90 (270) degrees
+	return DRM_MODE_PANEL_ORIENTATION_LEFT_UP;
+}
+
 static const struct drm_panel_funcs jdi_panel_funcs = {
 	.disable = jdi_panel_disable,
 	.unprepare = jdi_panel_unprepare,
 	.prepare = jdi_panel_prepare,
 	.enable = jdi_panel_enable,
 	.get_modes = jdi_panel_get_modes,
+	.get_orientation = jdi_panel_get_orientation
 };
 
 static const struct of_device_id jdi_of_match[] = {
